const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B4Rs2uFc.js","assets/index-Cf4JPuoH.js","assets/parseSignature-BnYmAkus.js","assets/localBatchGatewayRequest-C9fJH1PX.js","assets/secp256k1-D7k8_PHw.js","assets/hashTypedData-CRAOXGbX.js","assets/index-DDVkR8H3.js","assets/index-9rb3pU_D.js"])))=>i.map(i=>d[i]);
import{db as m,bp as g,aW as C,dc as D,c1 as b,b2 as A,dd as I,de as _,cp as S}from"./index-Cf4JPuoH.js";import{df as R}from"./index-Cf4JPuoH.js";function k(f={}){let l,a,c,r;return m(n=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:e,withCapabilities:t,...o}={}){var s;try{const i=await this.getProvider(),h=e??((s=n.chains[0])==null?void 0:s.id);if(!h)throw new D;let{accounts:v,currentChainId:w}=await(async()=>{if(o.isReconnecting)return{accounts:(await i.request({method:"eth_accounts",params:[]})).map(u=>({address:g(u)})),currentChainId:await this.getChainId()};const d=await i.request({method:"wallet_connect",params:[{capabilities:"capabilities"in o&&o.capabilities?o.capabilities:{},chainIds:[b(h),...n.chains.filter(u=>u.id!==h).map(u=>b(u.id))]}]});return{accounts:(await i.request({method:"eth_accounts"})).map(u=>d.accounts.find(L=>L.address===u)??{address:u}).map(u=>({address:g(u.address),capabilities:u.capabilities??{}})),currentChainId:Number(d.chainIds[0])}})();if(a||(a=this.onAccountsChanged.bind(this),i.on("accountsChanged",a)),c||(c=this.onChainChanged.bind(this),i.on("chainChanged",c)),r||(r=this.onDisconnect.bind(this),i.on("disconnect",r)),e&&w!==e){const d=await this.switchChain({chainId:e}).catch(p=>{if(p.code===A.code)throw p;return{id:w}});w=(d==null?void 0:d.id)??w}return{accounts:t?v:v.map(d=>d.address),chainId:w}}catch(i){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(i.message)?new A(i):i}},async disconnect(){const e=await this.getProvider();a&&(e.removeListener("accountsChanged",a),a=void 0),c&&(e.removeListener("chainChanged",c),c=void 0),r&&(e.removeListener("disconnect",r),r=void 0),e.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(t=>g(t))},async getChainId(){const t=await(await this.getProvider()).request({method:"eth_chainId"});return Number(t)},async getProvider(){if(!l){const e=(()=>{var s;return typeof f.preference=="string"?{options:f.preference}:{...f.preference,options:((s=f.preference)==null?void 0:s.options)??"all"}})(),{createBaseAccountSDK:t}=await(()=>{try{return I(()=>import("./index-B4Rs2uFc.js"),__vite__mapDeps([0,1,2,3,4,5]))}catch{throw new Error('dependency "@base-org/account" not found')}})();l=t({...f,appChainIds:n.chains.map(s=>s.id),preference:e}).getProvider()}return l},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:e,chainId:t}){var i,h,v,w;const o=n.chains.find(d=>d.id===t);if(!o)throw new C(new D);const s=await this.getProvider();try{return await s.request({method:"wallet_switchEthereumChain",params:[{chainId:b(o.id)}]}),o}catch(d){if(d.code===4902)try{let p;e!=null&&e.blockExplorerUrls?p=e.blockExplorerUrls:p=(i=o.blockExplorers)!=null&&i.default.url?[(h=o.blockExplorers)==null?void 0:h.default.url]:[];let y;(v=e==null?void 0:e.rpcUrls)!=null&&v.length?y=e.rpcUrls:y=[((w=o.rpcUrls.default)==null?void 0:w.http[0])??""];const u={blockExplorerUrls:p,chainId:b(t),chainName:(e==null?void 0:e.chainName)??o.name,iconUrls:e==null?void 0:e.iconUrls,nativeCurrency:(e==null?void 0:e.nativeCurrency)??o.nativeCurrency,rpcUrls:y};return await s.request({method:"wallet_addEthereumChain",params:[u]}),o}catch(p){throw new A(p)}throw new C(d)}},onAccountsChanged(e){e.length===0?this.onDisconnect():n.emitter.emit("change",{accounts:e.map(t=>g(t))})},onChainChanged(e){const t=Number(e);n.emitter.emit("change",{chainId:t})},async onDisconnect(e){n.emitter.emit("disconnect");const t=await this.getProvider();a&&(t.removeListener("accountsChanged",a),a=void 0),c&&(t.removeListener("chainChanged",c),c=void 0),r&&(t.removeListener("disconnect",r),r=void 0)}}))}q.type="safe";function q(f={}){const{shimDisconnect:l=!1}=f;let a,c;return m(r=>({id:"safe",name:"Safe",type:q.type,async connect({withCapabilities:n}={}){var s;const e=await this.getProvider();if(!e)throw new _;const t=await this.getAccounts(),o=await this.getChainId();return c||(c=this.onDisconnect.bind(this),e.on("disconnect",c)),l&&await((s=r.storage)==null?void 0:s.removeItem("safe.disconnected")),{accounts:n?t.map(i=>({address:i,capabilities:{}})):t,chainId:o}},async disconnect(){var e;const n=await this.getProvider();if(!n)throw new _;c&&(n.removeListener("disconnect",c),c=void 0),l&&await((e=r.storage)==null?void 0:e.setItem("safe.disconnected",!0))},async getAccounts(){const n=await this.getProvider();if(!n)throw new _;return(await n.request({method:"eth_accounts"})).map(g)},async getProvider(){if(typeof window<"u"&&(window==null?void 0:window.parent)!==window){if(!a){const{default:e}=await(()=>{try{return I(()=>import("./index-DDVkR8H3.js").then(i=>i.e),__vite__mapDeps([6,1,5]))}catch{throw new Error('dependency "@safe-global/safe-apps-sdk" not found')}})(),t=new e(f),o=await S(()=>t.safe.getInfo(),{timeout:f.unstable_getInfoTimeout??10});if(!o)throw new Error("Could not load Safe information");const s=await(async()=>{const i=await(()=>{try{return I(()=>import("./index-9rb3pU_D.js").then(h=>h.i),__vite__mapDeps([7,1,6,5]))}catch{throw new Error('dependency "@safe-global/safe-apps-provider" not found')}})();return typeof i.SafeAppProvider!="function"&&typeof i.default.SafeAppProvider=="function"?i.default.SafeAppProvider:i.SafeAppProvider})();a=new s(o,t)}return a}},async getChainId(){const n=await this.getProvider();if(!n)throw new _;return Number(n.chainId)},async isAuthorized(){var n;try{return l&&await((n=r.storage)==null?void 0:n.getItem("safe.disconnected"))?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){r.emitter.emit("disconnect")}}))}export{k as baseAccount,R as injected,q as safe};
